# XS2ASandbox

Implementation of the dynamic sandbox based on the adorsys ledgers core banking system and XS2A services.

## Running the XS2ASandbox

0.For build and run XS2ASandbox requires GNU Make to be installed on your local machine. Please, make sure it is installed.

1.Download the project and go to the project directory:

```sh
> git clone https://github.com/adorsys/XS2A-Sandbox
> cd XS2A-Sandbox
```

2.This sandbox runs with the docker-compose that can be found at:  [docker-compose.yml](docker-compose.yml) and [Makefile](Makefile).
But before you run this, first of all you should check if all build dependencies are installed:

```sh
> make check
```

If something is missing, install it to your local machine, otherwise the build will fail. 
List of dependencies that are required to use XS2ASandbox: **Java 8**, **nodeJs**, **AngularCLI**, **asciidoctor**, **jq**, **docker**, **docker-compose**, **maven**, **plantuml**.

.Here are links where you can install needed dependencies:
|=== 
|Dependency |Link 
|Java 8 | https://openjdk.java.net/install/
|Node.js 11.x       | https://nodejs.org/en/download 
|Angular CLI 7.x    | https://angular.io/guide/quickstart                        
|Asciidoctor 2.0    | https://asciidoctor.org
|jq 1.6 | https://stedolan.github.io/jq/download  
|NGINX 1.15.5       | http://nginx.org/download
|PostgreSQL  9.5    | https://www.postgresql.org/download
|Maven    3.5       | https://maven.apache.org/download.cgi
|PlantUML 1.2019.3  | http://plantuml.com/en/starting
|===

**Note 1**: please, use **Node.js** version lower than **12** (e.g. **10.x.x** or **11.x.x**). Otherwise angular applications would not be built due to
version conflicts.

**Note 2**: check amount of memory given to **Docker** (Open Docker Desktop -> Preferences -> Advanced -> Memory).
For a fast and painless start of all the services it should be not less than 5 GB.

3.Build the project with Makefile:
  
```sh 
> make all
```

4.Table of services and dependencies:
|===
|Service |Dependency |Env variables |Ports     
|xs2a-connector-examples |Java 8 | SPRING_PROFILES_ACTIVE 
ASPSP-PROFILE_BASEURL 
CONSENT-SERVICE_BASEURL 
CMS_URL 
LEDGERS_URL | 8089,8189 
|xs2a-asps--profile      |Java 8 | SPRING_PROFILES_ACTIVE 
JAVA_TOOL_OPTIONS 
BANK_PROFILE_PATH | 48080           
|xs2a-consent-management |Java 8 | ASPSP-PROFILE_BASEURL
SPRING_DATASOURCE_URL
SPRING_DATASOURCE_USERNAME
SPRING_DATASOURCE_PASSWORD
SERVER_KEY
SPRING_LIQUIBASE_ENABLED
USED-NON-RECURRING-CONSENT-EXPIRATION.CRON.EXPRESSION | 38080          
| xs2a-consent-management-db | Postgresql 9.5 | POSTGRESQL_ADMIN_PASSWORD
POSTGRESQL_DATABASE
POSTGRESQL_USER
POSTGRESQL_PASSWORD | 5432
|xs2a-online-banking | NGINX 1.15.5
|XS2A_URL
LEDGERS_URL
CMS_URL
ONLINE_BANKING_SCA_LOGINPAGE
ONLINE_BANKING_SCA_UIREDIRECT | 8090,8190
|ledgers | Java 8 | SPRING_PROFILES_ACTIVE
SPRING_JPA_SHOW_SQL
DB_HOST
DB_URL
DB_DATABASE
DB_USER
DB_PASSWORD
LIQUIBASE_ENABLED
SCA_MULTILEVEL_ENABLED
SPRING_MAIL_HOST
SPRING_MAIL_PORT
| 8088,8188
|xs2a-online-banking-ui |NGINX 1.15.5 | ONLINE_BANKING_SERVER_URL
DEV_PORTAL_URL_EXT | 4400
|xs2a-tpp-ui | NGINX 1.15.5 |  TPP_REST_SERVER_URL
CERT_GEN_URL | 4205
| xs2a-tpp-rest-server |Java 8 |  LEDGERS_URL,
SPRING_DATASOURCE_URL, 
SPRING_DATASOURCE_USERNAME,
SPRING_DATASOURCE_PASSWORD,
SERVER_KEY,
USED-NON-RECURRING-CONSENT-EXPIRATION.CRON.EXPRESSION,
 NOT-CONFIRMED-CONSENT-EXPIRATION.CRON.EXPRESSION,
NOT-CONFIRMED-PAYMENT-EXPIRATION.CRON.EXPRESSION,
CONSENT.CRON.EXPRESSION,
STOPLIST.CRON.EXPRESSION,
ENCRYPTION.CRON.EXPRESSION| 8093
|developer-portal-ui | NGINX 1.15.5 |  XS2A_URL | 4206
|ledgers-db |  Postgresql 9.5  | POSTGRESQL_ADMIN_PASSWORD
POSTGRESQL_DATABASE
POSTGRESQL_USER
POSTGRESQL_PASSWORD
|  5432
|certificate-generator |Java 8 | | 8092
| fakesmtp | Docker | |
|===


4.Prepare and  run  xs2a-connector-examples:

...

5.Prepare and run xs2a-asps-profile:

...

6.Prepare and run xs2a-consent-management:

...

7.Prepare and run xs2a-consent-management-db:

...

8.Prepare and run xs2a-online-banking: 

...

9.Prepare and run ledgers:

...

10.Prepare and run xs2a-online-banking-ui:

...

11.Prepare and run xs2a-tpp-ui:

...

12.Prepare and run xs2a-tpp-rest-server:

...

13.Prepare and run developer-portal-ui:

...

14.Prepare and run certificate-generator:

...

15.Prepare and run fakesmtp:

...

16.Prepare and run ledgers-db:

...

17.Open [Developer Portal](http://localhost:4206) and follow the manual to start working with XS2ASandbox.


## Links to local Swagger Interfaces

Following urls will access the swagger interfaces:

### XS2A Interface

```
http://localhost:8089/swagger-ui.html
```

### ASPSP-profile

ASPSP-profile is a module where bank-specific settings are stored.

```
http://localhost:48080/swagger-ui.html
```

## Links to local User Interfaces

### Developer portal UI

Developer portal is the main information resource on how to get started, how to test and work with XS2ASandbox.

```
http://localhost:4206
```

### Online banking UI

Online banking UI is an Angular application, developed to provide consents, payment confirmations and cancellation from PSU to ASPSP
 in case of redirect SCA approach.

```
http://localhost:4400
```

### TPP UI

TPP UI is an Angular application, which provides a user interface to TPP and allows to register, get test certificate and 
manage users and accounts.

```
http://localhost:4205
```
