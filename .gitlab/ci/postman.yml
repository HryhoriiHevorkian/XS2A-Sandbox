##################
# Docker Testing #
##################

DT postman:
  stage: "Docker Testing"
  variables:
    DOCKER_DIR: ${DOCKER_DIR_POSTMAN_TESTS}
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
  extends: .build_dockerimage

# TODO: what happens with postman?

#postman_tests:
#  stage: "Test"
#  image:
#    name: postman/newman_alpine33
#    entrypoint: [""]
#  only:
#    - schedules
#  script:
#    - npm config set unsafe-perm true
#    - npm install -g newman-reporter-html
#    - cd postman-scripts
#    - newman run postman_collection.json -e postman_environment_dev.json -g postman_global_variable.json --reporters cli,html --reporter-html-template html_report_template.hbs --reporter-html-export postman-tests-report.html --suppress-exit-code
#  artifacts:
#    when: always
#    paths:
#      - "postman-scripts/postman-tests-report.html"
#    expire_in: "10 day"git

#####################
# Docker Publishing #
#####################

DP postman develop:
  stage: "Docker Publishing"
  only:
    - develop
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: develop
  extends: .publish_dockerhub

DP postman nightly:
  stage: "Docker Publishing"
  only:
    - schedules
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: nightly
  extends: .publish_dockerhub

DP postman master:
  stage: "Docker Publishing"
  only:
    - master
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: latest
  extends: .publish_dockerhub

########################
# OpenShift Deployment #
########################

OD postman develop:
  stage: "OpenShift Deployment"
  only:
    - develop
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: develop # Dockerhub source tag
    OPENSHIFT_NAMESPACE: ${OPENSHIFT_NAMESPACE_DEV} # Openshift target namespace
  extends: .deploy_openshift

OD postman nightly:
  stage: "OpenShift Deployment"
  only:
    - schedules
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: nightly # Dockerhub source tag
    OPENSHIFT_NAMESPACE: ${OPENSHIFT_NAMESPACE_INTEG} # Openshift target namespace
  extends: .deploy_openshift

OD postman demo:
  stage: "OpenShift Deployment"
  only:
    - master
  variables:
    DOCKER_IMAGE: ${DOCKER_IMAGE_POSTMAN_TESTS}
    DOCKER_TAG: latest # Dockerhub source tag
    OPENSHIFT_NAMESPACE: ${OPENSHIFT_NAMESPACE_DEMO} # Openshift target namespace
  extends: .deploy_openshift